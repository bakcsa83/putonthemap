<?xml version="1.1" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:appdba="http://www.datical.net/xml/ns/appdba"
                   xmlns:datical="http://www.datical.net/xml/ns/datical"
                   xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
    <changeSet id="empty_db" author="bakcsa">
        <tagDatabase tag="empty_db"/>
    </changeSet>

    <changeSet author="bakcsa" id="create person">
        <createTable tableName="person">
            <column name="id" autoIncrement="true" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="person_pkey"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="email" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="first_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="VARCHAR(100)">
                <constraints nullable="false"/>
            </column>
            <column name="password" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="pwd_salt" type="VARCHAR(255)">
                <constraints nullable="false"/>
            </column>
            <column name="updated_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="auth_code" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="status" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="activation_email_count" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="bakcsa (generated)" id="add person_email_unique">
        <addUniqueConstraint columnNames="email" constraintName="person_email_unique" tableName="person"/>
    </changeSet>

    <changeSet author="bakcsa" id="create address">
        <createTable tableName="address">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="address_pkey"/>
            </column>
            <column name="person" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="name" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="company_name" type="VARCHAR(250)"/>
            <column name="country" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="city" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="zip" type="VARCHAR(25)">
                <constraints nullable="false"/>
            </column>
            <column name="address1" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="address2" type="VARCHAR(250)"/>
            <column name="primary_" type="BOOLEAN">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet context="test, dev, prod" author="bakcsa (generated)" id="add address_person_fk">
        <addForeignKeyConstraint baseColumnNames="person" baseTableName="address" constraintName="address_person_fk" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="person" validate="true"/>
    </changeSet>

    <changeSet author="bakcsa" id="create privilege">
        <createTable tableName="privilege">
            <column name="id" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="privilege_pkey"/>
            </column>
            <column name="name" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="bakcsa" id="add privilege_name_unique">
        <addUniqueConstraint columnNames="name" constraintName="privilege_name_unique" tableName="privilege"/>
    </changeSet>

    <changeSet author="bakcsa" id="create role">
        <createTable tableName="role">
            <column autoIncrement="true" name="id" type="BIGSERIAL">
                <constraints primaryKey="true" primaryKeyName="role_pkey"/>
            </column>
            <column name="name" type="VARCHAR(250)">
                <constraints nullable="false"/>
            </column>
            <column name="created_on" type="TIMESTAMP WITHOUT TIME ZONE">
                <constraints nullable="false"/>
            </column>
            <column name="version" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="bakcsa" id="add role_name_unique">
        <addUniqueConstraint columnNames="name" constraintName="role_name_unique" tableName="role"/>
    </changeSet>

    <changeSet id="create role_privilege" author="bakcsa">
        <createTable tableName="role_privilege">
            <column name="role" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="role_privilege_pkey"/>
            </column>
            <column name="privilege" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="role_privilege_pkey"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="bakcsa" id="create role_privilege_privilege_fkey">
        <addForeignKeyConstraint baseColumnNames="privilege" baseTableName="role_privilege" constraintName="role_privilege_privilege_fkey" deferrable="false" initiallyDeferred="false" onDelete="RESTRICT" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="privilege" validate="true"/>
    </changeSet>
    <changeSet author="bakcsa" id="create role_privilege_role_fkey">
        <addForeignKeyConstraint baseColumnNames="role" baseTableName="role_privilege" constraintName="role_privilege_role_fkey" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="role" validate="true"/>
    </changeSet>

    <changeSet author="bakcsa" id="create person_role">
        <createTable tableName="person_role">
            <column name="person" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="person_role_pkey"/>
            </column>
            <column name="role" type="BIGINT">
                <constraints primaryKey="true" primaryKeyName="person_role_pkey"/>
            </column>
        </createTable>
    </changeSet>

    <changeSet author="bakcsa" id="create person_role_person_fkey">
        <addForeignKeyConstraint baseColumnNames="person" baseTableName="person_role" constraintName="person_role_person_fkey" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="person" validate="true"/>
    </changeSet>

    <changeSet author="bakcsa" id="person_role_role_fkey">
        <addForeignKeyConstraint baseColumnNames="role" baseTableName="person_role" constraintName="person_role_role_fkey" deferrable="false" initiallyDeferred="false" onDelete="CASCADE" onUpdate="CASCADE" referencedColumnNames="id" referencedTableName="role" validate="true"/>
    </changeSet>
</databaseChangeLog>